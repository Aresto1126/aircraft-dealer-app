# LUXURY-AIRCRAFT 顧客管理システム (Web版)

GTA5 FiveMサーバーの航空機ディーラー「LUXURY-AIRCRAFT」向けの顧客管理Webアプリケーションです。  
**純粋なHTML、CSS、JavaScriptで構成されており、サーバーが不要で、ブラウザで直接実行できます。**

## 🎯 特徴

- 💻 **サーバー不要**: HTML/CSS/JavaScriptのみで動作
- 📊 **完全な顧客管理**: 顧客情報と所有航空機の詳細管理
- ✈️ **航空機管理**: GTA5の航空機を含む豊富なラインナップ
- 💰 **利益管理**: 仕入れ価格（定価の50%）、販売員給与（販売価格の30%）を考慮したディーラー実利益の自動計算
- 🏷️ **割引機能**: 最大70%OFFまでの割引適用とリアルタイム計算
- 📈 **販売統計**: 総売上・総利益のリアルタイム表示
- 🚁 **機種別管理**: 各顧客の機種別所有台数と購入履歴を詳細表示
- 💴 **日本語価格表示**: 億・万を使った読みやすい価格表記
- 🎉 **ポップアップ通知**: 販売完了時の美しいモーダル表示
- 🏦 **金庫管理**: 手動での入出金、残高調整、履歴管理機能
- 💾 **自動保存**: ブラウザのローカルストレージに自動保存
- 📱 **レスポンシブ**: PC・タブレット・スマートフォン対応
- 🎨 **美しいUI**: モダンなデザインとアニメーション

## 🚀 使用方法

### 1. ファイルのダウンロード
以下のファイルをダウンロードしてください：
- `index.html` - メインアプリケーション
- `style.css` - スタイルシート
- `script.js` - JavaScriptロジック

### 2. アプリケーションの起動
1. `index.html` をダブルクリックしてブラウザで開く
2. または、右クリック → "プログラムから開く" → お好みのブラウザを選択

### 3. 基本的な使い方

#### 📝 販売登録
1. 右上の「販売追加」ボタンをクリック
2. 以下の情報を入力：
   - **顧客選択**: 既存顧客をプルダウンから選択、または「新規顧客」を選択
     - 既存顧客は五十音順でソートされて表示
     - 新規顧客を選択すると名前入力フィールドが表示
   - **航空機名**: カテゴリ別に分類されたリストから選択
     - 航空機を選択すると定価と仕入れ価格が表示されます
     - 「その他」を選択するとカスタム機体を入力可能
   - **台数**: 購入台数（基本は1台、複数台購入にも対応）
   - **単価**: 1台あたりの価格（定価が自動表示）
   - **割引率**: 0-70%の範囲で入力（複数台の場合は1台分のみ適用）
   - **販売日**: 自動で現在日時が設定
3. 「販売を登録」ボタンをクリック

**👥 顧客選択システム:**
- **既存顧客選択**: 登録済み顧客をプルダウンから選択
- **新規顧客対応**: 「新規顧客」選択で名前入力フィールドが表示
- **自動更新**: 新規顧客登録時にプルダウンが自動更新
- **ソート機能**: 顧客名を五十音順で表示

**🚁 複数台購入システム:**
- **台数選択**: 1台から任意の台数まで選択可能
- **割引適用**: 複数台購入時でも割引は1台分のみ
- **価格計算**: (割引適用1台の価格) + (残り台数 × 定価)
- **個別管理**: 各航空機は個別に管理され、所有者情報も保持

**💡 利益計算システム:**
- **仕入れ価格**: 定価の50%で自動計算（全台数分）
- **販売員給与**: 販売価格の30%で自動計算
- **粗利益**: 販売価格 - 仕入れ価格
- **ディーラー実利益**: 粗利益 - 販売員給与
- **割引計算**: 割引率入力でリアルタイム計算
- **統計更新**: ディーラー実利益がダッシュボードに表示

**💰 価格管理機能:**
- 定価、仕入れ価格、販売員給与、ディーラー利益を表示
- 複数台購入時の総額をリアルタイム計算
- 割引適用時の詳細な内訳を表示
- 販売成功時にディーラー実利益額を表示

**💼 販売員給与システム:**
- **自動計算**: 販売価格の30%を販売員給与として自動計算
- **詳細表示**: 販売履歴で販売員給与を個別表示
- **実利益**: 販売員給与を差し引いたディーラーの実際の利益を表示
- **透明性**: 全ての金額内訳を明確に管理
- **⚠️ 注意**: 大幅割引時はディーラー利益がマイナスになる場合があります

**⚡ 効率化機能:**
- 既存顧客への再販時に入力作業を大幅短縮
- 顧客プルダウンによる入力ミス防止
- リピート顧客への対応時間短縮

**🎉 通知システム:**
- **販売完了ポップアップ**: 取引詳細を美しいモーダルで表示
  - 航空機名、台数、割引情報、利益額を詳細表示
  - アニメーション付きで印象的な完了通知
  - 4秒後に自動で閉じる
- **エラー通知**: 赤いトーストで入力エラーを表示
- **操作完了**: その他の操作は控えめなトーストで通知

**🚁 機種別管理機能:**
- **所有状況一覧**: 各顧客が何機種、何台ずつ所有しているかを一目で確認
- **機種別台数**: 同じ機種を複数台所有している場合の台数表示
- **価格集計**: 機種別の合計購入額を自動計算
- **購入履歴**: 各機種の個別購入履歴をアコーディオン表示

**🎉 ポップアップ通知システム:**
- **販売成功**: 美しいモーダルポップアップで取引詳細を表示
- **エラー通知**: 右上にトーストでエラーメッセージを表示
- **操作確認**: その他の操作は控えめなトースト通知
- **自動消去**: 設定時間後に自動で非表示

#### 👥 顧客管理
- **ダッシュボード**: 顧客一覧と統計を確認
- **顧客一覧**: 詳細な顧客テーブル表示
- **顧客詳細**: 顧客名をクリックで詳細モーダル表示
  - **機種別所有状況**: 各航空機の機種別台数と合計価格を表示
  - **個別履歴**: アコーディオン形式で各機種の購入履歴を詳細表示
  - **価格表示**: 億・万を使った日本語形式で表示

#### ✈️ 航空機管理
- **航空機一覧**: 販売済み航空機の一覧表示
- **所有者情報**: 各航空機の所有者情報

#### 📈 販売履歴・利益管理
- **販売履歴**: 時系列での販売記録表示
- **詳細情報**: 台数、総販売価格、販売員給与、ディーラー利益を表示
- **複数台表示**: 購入台数をバッジで表示、割引適用状況も明示
- **割引表示**: 複数台購入時は「1台分○%OFF適用」と表示
- **統計情報**: 総顧客数、販売機数、総売上、**ディーラー実利益**を表示
- **利益分析**: 販売員給与を考慮した実際のディーラー収益性を一目で確認

#### 🏦 金庫管理
- **自動入金**: 販売時にディーラー利益が自動で金庫に入金
- **手動出金**: イベントや緊急時の支払いに対応
  - 出金額と用途を入力
  - 残高不足時のエラー表示
  - 出金履歴の詳細記録
- **残高調整**: 実地確認や修正時の残高調整機能
  - 現在残高から新残高への直接変更
  - 調整理由の記録
  - 調整履歴の管理
- **削除時の自動調整**: データ削除時の金庫残高自動調整
  - 販売記録削除時：該当利益・損失を金庫から取り消し
  - 顧客削除時：該当顧客の全販売利益を一括取り消し
  - 航空機削除時：関連販売記録の利益を自動調整
  - 削除理由と調整額を履歴に詳細記録
- **履歴管理**: すべての金庫操作の詳細履歴
  - 操作日時、種類、金額、内容、操作後残高を記録
  - 入金、出金、調整、削除時調整を色分けで表示
  - 最新順での履歴表示
- **統計表示**: 
  - ダッシュボードに現在の金庫残高を表示
  - 入金・出金回数の統計
  - 美しいUI（金色グラデーション）で金庫状況を表示
- **整合性保証**: 
  - どのような削除操作でも金庫残高の整合性を完全に維持
  - 利益がある販売削除時は金庫から差し引き
  - 損失がある販売削除時は金庫に戻す

## 🛩️ 対応航空機

### 🚁 **ヘリコプター (Vanila)**
- **カーゴボブ** - ¥5400万円
- **コナダ** - ¥3500万円
- **フロガー** - ¥5000万円
- **ハボック** - ¥2000万円
- **マーベリック** - ¥3600万円
- **シースパ** - ¥2800万円
- **スパロー** - ¥2500万円
- **スーパーヴォリト** - ¥4000万円
- **スーパーヴォリトカーボン** - ¥4500万円
- **スウィフト** - ¥3900万円
- **ヴォラタス** - ¥3800万円

### 🛸 **MOD機体**
- **Batwing** - ¥2億5000万円
- **TB2** - ¥1億5000万円
- **Duster** - ¥3000万円
- **FH1 Hunter** - ¥6000万円
- **リトルバード** - ¥8000万円

### 🌍 **海外実車**
- **Acura 2018 (タコスのわがまま号)** - ¥1億5000万円

### 💥 **軍事車両**
- **スラスター** - ¥2億円

### ✈️ **飛行機**
- **RO-86 Alkonost** - ¥5億円
- **Buckingham Alpha-Z1** - ¥1億円
- **Mammoth Avenger** - ¥10億円 🏆 最高額
- **Western Company Besra** - ¥1億5000万円
- **Western Company Cuban 800** - ¥1億円
- **Mammoth Dodo** - ¥1億円
- **Western Company Seabreeze** - ¥1億円
- **Western Company Duster** - ¥1億円
- **Buckingham Shamal** - ¥3億円
- **Buckingham Luxor** - ¥3億円
- **JoBuilt Velum** - ¥1億円
- **Buckingham Luxor Deluxe** - ¥3億円
- **JoBuilt Velum 5-seater** - ¥1億円
- **Buckingham Vestra** - ¥1億円
- **Jpbuilt Mammatus** - ¥1億円
- **Ultralight** - ¥1000万円 💰 最安値
- **Buckingham Miljet** - ¥5億円
- **Buckingham Nimbus** - ¥3億円
- **Western Company Mallard** - ¥1億円

### ⚙️ **便利機能**
- **カテゴリ別表示**: 航空機がカテゴリ別に整理されて表示
- **価格自動入力**: 航空機を選択すると価格が自動で入力
- **参考価格表示**: 各航空機の標準価格を確認可能
- **カスタム機体**: リストにない航空機も手動で追加可能

## 💾 データ管理

### 自動保存
- すべてのデータはブラウザのローカルストレージに自動保存
- アプリケーションを閉じても データは保持されます
- 同じブラウザで開く限り、データは永続化されます

### データの場所
データは以下の形式でローカルストレージに保存されます：
- `luxury-aircraft-customers` - 顧客データ
- `luxury-aircraft-aircraft` - 航空機データ  
- `luxury-aircraft-sales` - 販売履歴データ
- `luxury-aircraft-cashbox` - 金庫データ（残高・履歴）

### データのバックアップ
**重要**: データはブラウザに依存するため、以下の場合にデータが失われる可能性があります：
- ブラウザのキャッシュクリア
- ブラウザのアンインストール
- 異なるブラウザでの使用

定期的にブラウザのブックマークをエクスポートするか、重要なデータは手動でメモを取ることをお勧めします。

## 🔧 カスタマイズ

### 航空機の追加
`script.js` の `航空機名` セレクトボックス部分を編集：

```javascript
<select class="form-select" id="aircraft-name" required>
    <option value="">選択してください</option>
    <option value="新しい航空機">新しい航空機</option>
    // 新しい航空機を追加
</select>
```

### スタイルの変更
`style.css` でカラーテーマや レイアウトをカスタマイズ：

```css
.stats-card {
    background: linear-gradient(135deg, #新しい色1, #新しい色2);
}
```

## 📱 対応ブラウザ

- **Chrome** 80+ ✅
- **Firefox** 75+ ✅  
- **Safari** 13+ ✅
- **Edge** 80+ ✅
- **Internet Explorer** ❌ (非対応)

## 🛠️ トラブルシューティング

### データが保存されない
1. ブラウザがローカルストレージをサポートしているか確認
2. プライベートモード/シークレットモードでは使用しない
3. ブラウザの設定でJavaScriptが有効になっているか確認

### 表示が崩れる
1. ブラウザのキャッシュをクリア
2. ページを再読み込み (Ctrl+F5 または Cmd+R)
3. 対応ブラウザの最新版を使用

### 航空機名が表示されない
1. 「その他」を選択した場合、カスタム航空機名を入力
2. 必須項目がすべて入力されているか確認

## 📋 データ構造

### 顧客データ
```json
{
  "id": 1703123456789,
  "name": "田中太郎",
  "createdAt": "2024-01-01T10:00:00.000Z"
}
```

### 航空機データ
```json
{
  "id": 1703123456790,
  "name": "Luxor",
  "price": 1500000,
  "originalPrice": 3000000,
  "discountRate": 50,
  "costPrice": 1500000,
  "profit": 0,
  "customerId": 1703123456789,
  "purchaseDate": "2024-01-01T10:00:00"
}
```

### 販売データ
```json
{
  "id": 1703123456791,
  "customerName": "田中太郎",
  "aircraftName": "Luxor", 
  "price": 1500000,
  "originalPrice": 3000000,
  "discountRate": 50,
  "costPrice": 1500000,
  "profit": 0,
  "saleDate": "2024-01-01T10:00:00"
}
```

### 金庫データ
```json
{
  "balance": 150000000,
  "history": [
    {
      "id": 1703123456792,
      "type": "deposit",
      "amount": 50000000,
      "description": "販売による利益: Luxor",
      "date": "2024-01-01T10:00:00.000Z",
      "balanceAfter": 50000000
    },
    {
      "id": 1703123456793,
      "type": "withdrawal",
      "amount": 10000000,
      "description": "イベント支払い",
      "date": "2024-01-01T12:00:00.000Z",
      "balanceAfter": 40000000
    },
    {
      "id": 1703123456794,
      "type": "adjustment_deposit",
      "amount": 110000000,
      "description": "実地確認による調整 (残高調整: ¥4000万円 → ¥1億5000万円)",
      "date": "2024-01-01T15:00:00.000Z",
      "balanceAfter": 150000000
    }
  ]
}
```

### 新しいデータ項目
- **quantity**: 購入台数
- **unitPrice**: 1台あたりの単価
- **totalPrice**: 総販売価格
- **originalPrice**: 定価（基準価格）
- **discountRate**: 適用された割引率（%）
- **totalCostPrice**: 総仕入れ価格（定価の50% × 台数）
- **totalSalesCommission**: 総販売員給与（販売価格の30%）
- **totalGrossProfit**: 総粗利益（販売価格 - 仕入れ価格）
- **totalDealerProfit**: 総ディーラー実利益（粗利益 - 販売員給与）
- **batchId**: 同一取引の識別ID

### 利益計算の流れ
1. **販売価格**: 定価または割引価格
2. **仕入れ価格**: 定価 × 50%
3. **販売員給与**: 販売価格 × 30%
4. **粗利益**: 販売価格 - 仕入れ価格
5. **ディーラー実利益**: 粗利益 - 販売員給与

### ⚠️ 重要な注意点
販売員給与が販売価格の30%固定のため、大幅な割引販売時にディーラー利益がマイナスになる場合があります。
- **損益分岐点**: 販売価格が定価の約71.4%以下になるとディーラーは赤字
- **例**: 定価¥1000万円の機体を¥700万円以下で販売すると赤字
- **システム表示**: 赤字の場合は利益欄が赤色で表示されます

## 🎮 FiveMサーバーでの活用

このアプリケーションは以下のような用途で活用できます：

- **販売記録管理**: プレイヤーへの航空機販売記録
- **顧客データベース**: 常連客の購入履歴管理
- **売上統計**: 月間・年間売上の把握
- **在庫管理**: 人気機種の把握と在庫計画

## 📞 サポート

ご質問やご要望がございましたら、以下までご連絡ください：
- GitHubのIssuesセクション
- FiveMサーバーの管理者

## 📄 ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 🎯 使用例

### 単体購入の場合
**例**: ヘリコプター「Hunter」（定価: ¥5400万円）を30%OFFで販売
- **定価**: ¥5400万円
- **販売価格**: ¥3780万円（30%OFF）
- **仕入れ価格**: ¥2700万円（定価の50%）
- **販売員給与**: ¥1134万円（販売価格の30%）
- **粗利益**: ¥1080万円（販売価格 - 仕入れ価格）
- **ディーラー実利益**: -¥54万円（粗利益 - 販売員給与）

### 複数台購入の場合
**例**: ヘリコプター「Sparrow」（定価: ¥2500万円）を3台、1台分30%OFFで販売
- **1台目（30%OFF）**: ¥1750万円
- **2台目（定価）**: ¥2500万円
- **3台目（定価）**: ¥2500万円
- **総販売価格**: ¥6750万円
- **総仕入れ価格**: ¥3750万円（¥1250万円 × 3台）
- **販売員給与**: ¥2025万円（販売価格の30%）
- **粗利益**: ¥3000万円（販売価格 - 仕入れ価格）
- **ディーラー実利益**: ¥975万円（粗利益 - 販売員給与）

### 機種別所有状況の例
**田中太郎さんの所有状況:**
- **Sparrow**: 3台 - ¥6750万円（ディーラー利益: ¥975万円）
- **Hunter**: 1台 - ¥3780万円（30%OFF、ディーラー利益: -¥54万円）
- **Luxor**: 2台 - ¥6億円（ディーラー利益: ¥2億1000万円）
- **総所有**: 6機（3機種） - 総額¥7億3530万円
- **ディーラー総利益**: ¥2億1921万円

**🚁 複数台購入のメリット:**
- 大口顧客への対応が可能
- 割引は1台分のみで利益率を維持
- 販売履歴で台数と割引状況を明確に管理

**👥 顧客選択機能のメリット:**
- **リピート顧客**: 「田中太郎」さんが2回目の購入時は、プルダウンから選択するだけ
- **入力ミス防止**: 手入力による顧客名の誤字・脱字を防止
- **効率向上**: 常連客への販売時間を大幅短縮

### 金庫管理の使用例

#### 販売時の自動入金
**例**: 上記の「Sparrow」3台販売の場合
- **ディーラー実利益**: ¥975万円
- **金庫への自動入金**: ¥975万円
- **履歴記録**: 「販売による利益: Sparrow 3台」として記録

#### イベント時の出金
**例**: ゲーム内イベントで¥500万円の景品代を支払い
- **出金操作**: 金庫管理ページで出金フォームを使用
- **入力項目**:
  - 出金額: ¥500万円
  - 内容: 「レースイベント景品代」
- **結果**: 金庫残高から¥500万円が差し引かれ、履歴に記録

#### 残高調整の例
**例**: 実地確認で金庫残高に差異があった場合
- **現在残高**: ¥1000万円（システム表示）
- **実際残高**: ¥1200万円（現物確認）
- **調整操作**:
  - 新しい残高: ¥1200万円
  - 調整理由: 「実地確認による修正」
- **結果**: 残高が¥1200万円に調整され、¥200万円の調整入金として履歴に記録

#### 金庫履歴の例
```
日時                | 種類      | 金額        | 内容                    | 残高
2024-01-05 15:30   | 入金      | ¥975万円   | 販売による利益: Sparrow  | ¥2975万円
2024-01-05 18:00   | 出金      | ¥500万円   | レースイベント景品代     | ¥2475万円
2024-01-06 09:00   | 調整(+)   | ¥200万円   | 実地確認による修正       | ¥2675万円
```

**🏦 金庫管理のメリット:**
- **透明性**: すべての資金の動きが記録される
- **自動化**: 販売利益の自動計上で手作業ミスを防止
- **柔軟性**: イベントや緊急時の手動操作に対応
- **監査**: 詳細な履歴で資金管理の透明性を確保

このシステムにより、単体・複数台購入の両方に対応し、既存顧客・新規顧客への効率的な対応と、各販売の収益性を一目で把握できます！

**さらに金庫管理機能により、ディーラーの資金管理も完全に自動化・透明化されました！**

---

**🎯 LUXURY-AIRCRAFT 顧客管理システムで、あなたの航空機ビジネスを次のレベルへ！** 